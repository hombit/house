#!/usr/bin/env python3


from bottle import Bottle, request, run
from house import weather
from time import localtime


app = Bottle()

json_weather = app.get('/weather')(weather.get_weather)


@app.get('/pda')
def pda():
    jw = json_weather()
    w_now = jw['current_observation']
    if localtime().tm_hour < 19:
        w_day = jw['forecast']['simpleforecast']['forecastday'][0]
        day = 'Сегодня'
    else:
        w_day = jw['forecast']['simpleforecast']['forecastday'][1]
        day = 'Завтра'

    temp_now = weather.temperature(w_now['temp_c'])
    wind_now = weather.wind(w_now['wind_kph'])
    rel_hum_now = w_now['relative_humidity']
    pres_now = weather.pressure(w_now['pressure_mb'])

    low_day = weather.temperature(w_day['low']['celsius'])
    high_day = weather.temperature(w_day['high']['celsius'])
    max_wind_day = weather.wind(w_day['maxwind']['kph'])
    return f'''
        <meta http-equiv="refresh" content="300">
        <h2>{temp_now}&nbsp;C&nbsp;&nbsp;{rel_hum_now}&nbsp;&nbsp;{wind_now}&nbsp;м/с&nbsp;&nbsp;{pres_now}&nbsp;бар</h2>
        <h2>{day} от {low_day}&nbsp;C до {high_day}&nbsp;C и ветер до {max_wind_day}&nbsp;м/с</h2>
    '''

run(app, server='gunicorn', host='0.0.0.0', port=15134)

